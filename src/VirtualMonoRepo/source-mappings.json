// This file configures where the VMR synchronizes the sources from.
// Each development repository has a mapping record which says where the remote repo is,
// what files are in/excluded from the sync, etc.
//
// This file does not contain information about what version of sources is synchronized.
// Please check the source-manifest.json file for that purpose.
//
// More details on this file's mechanics:
// https://github.com/dotnet/arcade/blob/main/Documentation/UnifiedBuild/VMR-Design-And-Operation.md#repository-source-mappings
{
    // Location within the VMR where the source-build patches are stored
    // These patches are applied on top of the code synchronized into the VMR
    "patchesPath": "src/installer/src/SourceBuild/patches",

    "sourceMappingsPath": "src/installer/src/VirtualMonoRepo/source-mappings.json",

    // Some files are copied outside of the src/ directory into other locations
    // When files in the source paths are changed, they are automatically synchronized too
    "additionalMappings": [
        {
            "source": "src/installer/src/SourceBuild/content",
            "destination": ""
        },
        {
            "source": "src/installer/eng/common",
            "destination": "eng/common"
        },
        {
            "source": "src/installer/src/VirtualMonoRepo/source-mappings.json",
            "destination": "src"
        }
    ],

    // These defaults are added to all mappings unless `ignoreDefaults: true` is specified
    // When no "include" filter is specified, "**/*" is used
    // The default filters do not apply to submodules
    // Only filters which start with submodule's path are applied when syncing submodules
    "defaults": {
        "defaultRef": "main",
        "exclude": [
            "**/*.dll",
            "**/*.Dll",
            "**/*.exe",
            "**/*.mdb",
            "**/*.nupkg",
            "**/*.pdb",
            "**/*.tgz",
            "**/*.zip"
        ]
    },

    // Each of these mappings has a corresponding folder in the src/ directory
    "mappings": [
        {
            "name": "arcade",
            "defaultRemote": "https://github.com/dotnet/arcade",
            "include": [
                "src/Microsoft.DotNet.Build.Tasks.Feed.Tests/**/*",
                "src/Microsoft.DotNet.Build.Tasks.Workloads.Tests/**/*",
                "src/Microsoft.DotNet.NuGetRepack/tests/**/*",
                "src/Microsoft.DotNet.SignTool.Tests/**/*"
            ]
        },
        {
            "name": "aspire",
            "defaultRemote": "https://github.com/dotnet/aspire",
            "exclude": [
                "src/Aspire.Dashboard/**/*"
            ]
        },
        {
            "name": "aspnetcore",
            "defaultRemote": "https://github.com/dotnet/aspnetcore",
            "include": [
                "src/Servers/IIS/AspNetCoreModuleV2/CommonLibTests/Fake/**/*",
                "src/submodules/MessagePack-CSharp/**/*"
            ],
            "exclude": [
                // Non-OSS license - https://github.com/dotnet/source-build/issues/3537
                "src/Installers/Windows/AspNetCoreModule-Setup/**/*"
            ]
        },
        {
            "name": "cecil",
            "defaultRemote": "https://github.com/dotnet/cecil",
            "include": [
                "Test/Resources/assemblies/**/*",
                "rocks/Test/Resources/**/*",
                "symbols/mdb/Test/Resources/**/*",
                "symbols/pdb/Test/Resources/**/*"
            ]
        },
        {
            "name": "command-line-api",
            "defaultRemote": "https://github.com/dotnet/command-line-api"
        },
        {
            "name": "deployment-tools",
            "defaultRemote": "https://github.com/dotnet/deployment-tools"
        },
        {
            "name": "diagnostics",
            "defaultRemote": "https://github.com/dotnet/diagnostics"
        },
        {
            "name": "emsdk",
            "defaultRemote": "https://github.com/dotnet/emsdk"
        },
        {
            "name": "format",
            "defaultRemote": "https://github.com/dotnet/format"
        },
        {
            "name": "fsharp",
            "defaultRemote": "https://github.com/dotnet/fsharp",
            "include": [
                "tests/FSharp.Compiler.ComponentTests/**/*",
                "tests/fsharp/core/attributes/**/*",
                "tests/fsharp/core/ilread/**/*",
                "tests/fsharp/regression/**/*",
                "tests/fsharp/typecheck/full-rank-arrays/**/*",
                "tests/fsharpqa/Source/**/*",
                "tests/fsharpqa/testenv/bin/**/*",
                "tests/service/data/**/*"
            ]
        },
        {
            "name": "installer",
            "defaultRemote": "https://github.com/dotnet/installer",
            "exclude": [
                // We don't need the tarball content in the VMR again, it's already copied in the root
                "src/SourceBuild/content/**/*"
            ]
        },
        {
            "name": "msbuild",
            "defaultRemote": "https://github.com/dotnet/msbuild"
        },
        {
            "name": "nuget-client",
            "defaultRemote": "https://github.com/NuGet/NuGet.Client",
            "defaultRef": "dev",
            "include": [
                "test/EndToEnd/Packages/**/*",
                "test/NuGet.Clients.Tests/**/*",
                "test/NuGet.Core.FuncTests/**/*",
                "test/NuGet.Core.Tests/**/*",
                "test/TestUtilities/Test.Utility/**/*",
                "src/NuGet.Clients/NuGet.VisualStudio.Client"
            ]
        },
        {
            "name": "razor",
            "defaultRemote": "https://github.com/dotnet/razor",
            "include": [
                "src/Razor/test/Microsoft.VisualStudio.Razor.IntegrationTests/TestFiles/**/*"
            ]
        },
        {
            "name": "roslyn",
            "defaultRemote": "https://github.com/dotnet/roslyn",
            "include": [
                "src/Compilers/Test/Resources/Core/**/*",
                "src/Workspaces/MSBuildTest/Resources/Dlls/**/*"
            ]
        },
        {
            "name": "roslyn-analyzers",
            "defaultRemote": "https://github.com/dotnet/roslyn-analyzers"
        },
        {
            "name": "runtime",
            "defaultRemote": "https://github.com/dotnet/runtime",
            "include": [
                "src/libraries/Common/tests/**/*",
                "src/libraries/System.Diagnostics.FileVersionInfo/tests/**/*",
                "src/libraries/System.Private.Xml/tests/**/*",
                "src/libraries/System.Reflection.Metadata/tests/**/*"
            ]
        },
        {
            "name": "scenario-tests",
            "defaultRemote": "https://github.com/dotnet/scenario-tests"
        },
        {
            "name": "sdk",
            "defaultRemote": "https://github.com/dotnet/sdk",
            "include": [
                "src/Assets/TestPackages/dotnet-new/nupkg_templates/**/*",
                "test/Microsoft.DotNet.PackageInstall.Tests/**/*",
                "test/Microsoft.DotNet.ShellShim.Tests/**/*",
                "test/Microsoft.NET.Sdk.Publish.Tasks.Tests/**/*"
            ]
        },
        {
            "name": "source-build-externals",
            "defaultRemote": "https://github.com/dotnet/source-build-externals",
            "include": [
                "src/application-insights/WEB/Src/WindowsServer/WindowsServer.Tests/*/**"
            ],
            "exclude": [
                "src/application-insights/**/NuGet.config",
                "src/humanizer/samples/**/*.js",
                "src/newtonsoft-json/**/NuGet.Config",
                "src/spectre-console/docs/**",
                "src/spectre-console/NuGet.Config",
                "src/spectre-console/examples/Console/Canvas/Mandelbrot.cs",
                "src/xunit/NuGet.Config"
            ]
        },
        {
            "name": "source-build-reference-packages",
            "defaultRemote": "https://github.com/dotnet/source-build-reference-packages"
        },
        {
            "name": "sourcelink",
            "defaultRemote": "https://github.com/dotnet/sourcelink"
        },
        {
            "name": "symreader",
            "defaultRemote": "https://github.com/dotnet/symreader",
            "include": [
                "src/PdbTestResources/**/*"
            ]
        },
        {
            "name": "templating",
            "defaultRemote": "https://github.com/dotnet/templating",
            "include": [
                "test/Microsoft.TemplateEngine.TestTemplates/**/*"
            ]
        },
        {
            "name": "test-templates",
            "defaultRemote": "https://github.com/dotnet/test-templates",
            "include": [
                "Templates/Desktop-CSharp/packages/**/*",
                "Templates/Desktop-VisualBasic/packages/**/*",
                "Templates/EdgeDriver-DotNetFramework-CSharp/packages/**/*"
            ]
        },
        {
            "name": "vstest",
            "defaultRemote": "https://github.com/microsoft/vstest",
            "include": [
                "samples/Microsoft.TestPlatform.E2ETest/**/*",
                "samples/Microsoft.TestPlatform.TranslationLayer.E2ETest/**/*",
                "temp/cpp/**/*",
                "test/Microsoft.TestPlatform.CoreUtilities.UnitTests/**/*",
                "test/TestAssets/**/*"
            ],
            "exclude": [
                // Non-OSS license used in VS specific build configurations.
                "src/package/licenses/LICENSE_VS.txt"
            ]
        },
        {
            "name": "xdt",
            "defaultRemote": "https://github.com/dotnet/xdt"
        },
        {
            // TODO: Remove the xliff-tasks mapping once the synchronization flags it as unused
            // We no longer synchronize it but we can't remove it yet until
            // it disappears from all of the Version.Details.xml files.
            // https://github.com/dotnet/installer/issues/17661
            "name": "xliff-tasks",
            "defaultRemote": "https://github.com/dotnet/xliff-tasks",
            "ignoreDefaults": true,
            "exclude": [ "**/*" ]
        },
        {
            "name": "winforms",
            "defaultRemote": "https://github.com/dotnet/winforms",
            "include": [
                "src/System.Windows.Forms/tests/IntegrationTests/**/*"
            ]
        },
        {
            "name": "wpf",
            "defaultRemote": "https://github.com/dotnet/wpf",
        },
        {
            "name": "windowsdesktop",
            "defaultRemote": "https://github.com/dotnet/windowsdesktop"
        }
    ]
}
